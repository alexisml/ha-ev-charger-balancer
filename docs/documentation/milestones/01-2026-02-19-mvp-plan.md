Title: MVP Implementation Plan
Date: 2026-02-19
Author: alexisml
Status: draft
Summary: MVP roadmap for the EV charger load-balancing integration — single-charger support, action execution, observability, and HACS release.

---

This document contains the MVP (Phase 1) implementation roadmap. It was split out from [`docs/development-memories/2026-02-19-research-plan.md`](../../development-memories/2026-02-19-research-plan.md) so the delivery phases are clearly separated.

Multi-charger support (Phase 2) is tracked in a separate document: [`02-2026-02-19-multi-charger-plan.md`](02-2026-02-19-multi-charger-plan.md).

## Phase 1 — MVP (single-charger)

The MVP delivers a fully functional single-charger integration that can be installed via HACS and configured through the UI with no YAML required.

| PR milestone | Scope | Exit criteria |
|---|---|---|
| PR-1: Integration scaffold + Config Flow | Create `custom_components/ev_lb/` with `manifest.json`, `__init__.py`, `config_flow.py`, constants, and validation for required inputs (power meter, voltage, service current); add baseline HACS metadata (`hacs.json`) and a GitHub Actions unit-test workflow. | Integration loads in HA; config entry can be created/removed; basic tests for config flow pass; CI runs unit tests on PR/push. |
| PR-2: Core entities and device linking | Add `sensor.py`, `binary_sensor.py`, `number.py`, `switch.py`; register a charger device entry and attach per-charger entities. | Entities appear under the charger device; unique IDs stable; entity setup tests pass. |
| PR-3: Single-charger balancing engine | Port `compute_available_current` and `apply_ramp_up_limit` from `tests/` into integration runtime and subscribe to power-meter updates. | On meter change, target current updates correctly with instant down / delayed up behavior; unit tests cover core logic. |
| PR-4: Action execution contract | Implement configured `set_current` / `stop_charging` / `start_charging` service calls with payload validation and error handling. | Correct service calls are fired for increase/reduce/stop/resume transitions; integration tests assert payloads and unit tests cover payload validation/error paths. |
| PR-5-MVP: Event notifications | Fire HA events and persistent notifications when notable conditions occur (meter unavailable, overload/stop, charging resumed, fallback activated). | Dashboard shows persistent notifications for fault conditions; HA events can be consumed by automations; unit tests verify event payloads for each condition. |
| PR-6-MVP: Manual override + observability | Expose `ev_lb.set_limit` service and add/verify diagnostic state updates needed for troubleshooting. | Manual override changes runtime limits safely and state reflects changes without restart; unit tests cover limit and state transitions. |
| PR-7-MVP: Test stabilization + HACS release readiness | Finalize HACS requirements (`manifest.json`, `hacs.json`, repository structure/docs), complete integration tests (`pytest-homeassistant-custom-component`), and prepare first release. | CI is green on 3 consecutive runs, installation via HACS works, and docs cover configuration + troubleshooting. |
| PR-8-MVP: User manual | Create a comprehensive end-user manual covering installation, configuration, usage, event notifications, action scripts, troubleshooting, and FAQ. Consolidate existing guides into a single user-facing document. | User manual published in `docs/documentation/`; README links to manual; manual covers all user-facing features from PR-1 through PR-7. |

---

## Global quality gates (apply to every milestone PR)

- Add/update unit tests for every behavior introduced in that milestone.
- Keep the unit-test CI workflow green on every PR before merge.
- Include a short "how to test" section in each PR description (local `pytest` command + HA smoke check for the changed behavior).

## Review-and-update loop (required after every milestone)

After each PR milestone is merged:
1. Review implementation results vs the milestone exit criteria.
2. Record gaps, risks, and discovered edge cases.
3. Update this roadmap (scope/order/acceptance criteria) before starting the next PR.
4. Confirm test strategy updates needed for the next milestone.

## Next steps, timeline, deliverables

| Step | PR | Owner | ETA | Deliverable | Status |
|------|-----|-------|-----|-------------|--------|
| Scaffold custom integration | PR-1 | alexisml | +2 days | `custom_components/ev_lb/` with Config Flow, `hacs.json`, CI workflow | ✅ Done |
| Core entities and device linking | PR-2 | alexisml | +4 days | `sensor.py`, `binary_sensor.py`, `number.py`, `switch.py`; charger device entry | ✅ Done |
| Single-charger balancing engine | PR-3 | alexisml | +6 days | Port computation core + power-meter listener | ✅ Done |
| Action execution contract | PR-4 | alexisml | +7 days | `set_current` / `stop_charging` / `start_charging` service calls | ✅ Done |
| Event notifications | PR-5-MVP | alexisml | +8 days | HA events + persistent notifications for fault conditions | ✅ Done |
| Manual override + observability | PR-6-MVP | alexisml | +10 days | `ev_lb.set_limit` service + diagnostic state | ✅ Done |
| Test stabilization + HACS release | PR-7-MVP | alexisml | +12 days | Full integration tests, HACS-ready release | ✅ Done |
| User manual | PR-8-MVP | alexisml | +14 days | Comprehensive end-user manual covering all features | |
